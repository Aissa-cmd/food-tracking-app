{% extends 'base.html' %}

{% load static %}

{% block title %}TriFeul+ | Dashboard{% endblock %}

{% block body %}

{% if messages %}
{% for message in messages %}
<div class="alert alert-{{ message.tags }} alert-dismissible fade show mt-4" role="alert">
  {{ message }}
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}
{% endif %}

<div class='py-4 mt-auto'>
  <div class='container-fluid px-4'>

    <div class='row justify-content-center'>
      <div class='col-xl-12'>

        <div class='row'>
          <div class='col-md-6 mt-4'>

            <div class='card bg-secondary mb-3'>

              <div class='card-header'>
                <h5>Nourriture consommée </h5>
                <h5><strong class='text-primary'>{{ daily_food.date|date:'D, j F Y' }}</strong></h5>
              </div>
              <div class='card-body' style="padding: 0;">

                <div>
                  <!-- breakfast -->
                  <div class="d-flex justify-content-between align-items-center"
                    style="background-color: #e9ecef;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 0.5rem;padding-bottom: 0.5rem;">
                    <h4>Breakfast</h4>
                  </div>
                  <div style="padding: 0 1rem 1.5rem 1rem">
                    <table id='foodtable-fb' class='table table-hover'>
                      <thead>
                        <tr>
                          <th scope='col' class='col-md-2'>Food Item</th>
                          <th scope='col' class='col-md-2'>Poids (g)</th>
                          <th scope='col' class='col-md-2'>Calories</th>
                          <th scope='col' class='col-md-2'>Fat</th>
                          <th scope='col' class='col-md-2'>Carbs</th>
                          <th scope='col' class='col-md-2'>Protein</th>
                          <th scope='col' class='col-md-2'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for fb in breakfast %}
                        <tr>
                          <td class='col-md-2'>
                            <a href="{% url 'aliment_detail' pk=fb.aliment.id %}">{{ fb.aliment.name }}</a>
                          </td>
                          <td class='col-md-2'>{{ fb.weight_g }}</td>
                          <td class='col-md-2'>{{ fb.total_energy_value }}</td>
                          <td class='col-md-2'>{{ fb.fat }}</td>
                          <td class='col-md-2'>{{ fb.carboheidrates }}</td>
                          <td class='col-md-2'>{{ fb.protein }}</td>
                          <td>
                          </td>
                        </tr>
                        {% endfor %}
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div>
                  <!-- lunch -->
                  <div class="d-flex justify-content-between align-items-center"
                    style="background-color: #e9ecef;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 0.5rem;padding-bottom: 0.5rem;">
                    <h4>Lunch</h4>
                  </div>
                  <div style="padding: 0 1rem 1.5rem 1rem">
                    <table id='foodtable-lb' class='table table-hover'>
                      <thead>
                        <tr>
                          <th scope='col' class='col-md-2'>Food Item</th>
                          <th scope='col' class='col-md-2'>Poids (g)</th>
                          <th scope='col' class='col-md-2'>Calories</th>
                          <th scope='col' class='col-md-2'>Fat</th>
                          <th scope='col' class='col-md-2'>Carbs</th>
                          <th scope='col' class='col-md-2'>Protein</th>
                          <th scope='col' class='col-md-2'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for fb in lunch %}
                        <tr>
                          <td class='col-md-2'>
                            <a href="{% url 'aliment_detail' pk=fb.aliment.id %}">{{ fb.aliment.name }}</a>
                          </td>
                          <td class='col-md-2'>{{ fb.weight_g }}</td>
                          <td class='col-md-2'>{{ fb.total_energy_value }}</td>
                          <td class='col-md-2'>{{ fb.fat }}</td>
                          <td class='col-md-2'>{{ fb.carboheidrates }}</td>
                          <td class='col-md-2'>{{ fb.protein }}</td>
                          <td>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>

                <div>
                  <!-- dinner -->
                  <div class="d-flex justify-content-between align-items-center"
                    style="background-color: #e9ecef;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 0.5rem;padding-bottom: 0.5rem;">
                    <h4>Dinner</h4>
                  </div>
                  <div style="padding: 0 1rem 1.5rem 1rem">
                    <table id='foodtable-db' class='table table-hover'>
                      <thead>
                        <tr>
                          <th scope='col' class='col-md-2'>Food Item</th>
                          <th scope='col' class='col-md-2'>Poids (g)</th>
                          <th scope='col' class='col-md-2'>Calories</th>
                          <th scope='col' class='col-md-2'>Fat</th>
                          <th scope='col' class='col-md-2'>Carbs</th>
                          <th scope='col' class='col-md-2'>Protein</th>
                          <th scope='col' class='col-md-2'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for fb in dinner %}
                        <tr>
                          <td class='col-md-2'>
                            <a href="{% url 'aliment_detail' pk=fb.aliment.id %}">{{ fb.aliment.name }}</a>
                          </td>
                          <td class='col-md-2'>{{ fb.weight_g }}</td>
                          <td class='col-md-2'>{{ fb.total_energy_value }}</td>
                          <td class='col-md-2'>{{ fb.fat }}</td>
                          <td class='col-md-2'>{{ fb.carboheidrates }}</td>
                          <td class='col-md-2'>{{ fb.protein }}</td>
                          <td>
                          </td>
                        </tr>
                        {% endfor %}
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div>
                  <!-- Snack -->
                  <div class="d-flex justify-content-between align-items-center"
                    style="background-color: #e9ecef;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 0.5rem;padding-bottom: 0.5rem;">
                    <h4>Snack</h4>
                  </div>
                  <div style="padding: 0 1rem 1.5rem 1rem">
                    <table id='foodtable-sn' class='table table-hover'>
                      <thead>
                        <tr>
                          <th scope='col' class='col-md-2'>Food Item</th>
                          <th scope='col' class='col-md-2'>Poids (g)</th>
                          <th scope='col' class='col-md-2'>Calories</th>
                          <th scope='col' class='col-md-2'>Fat</th>
                          <th scope='col' class='col-md-2'>Carbs</th>
                          <th scope='col' class='col-md-2'>Protein</th>
                          <th scope='col' class='col-md-2'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for fb in snack %}
                        <tr>
                          <td class='col-md-2'>
                            <a href="{% url 'aliment_detail' pk=fb.aliment.id %}">{{ fb.aliment.name }}</a>
                          </td>
                          <td class='col-md-2'>{{ fb.weight_g }}</td>
                          <td class='col-md-2'>{{ fb.total_energy_value }}</td>
                          <td class='col-md-2'>{{ fb.fat }}</td>
                          <td class='col-md-2'>{{ fb.carboheidrates }}</td>
                          <td class='col-md-2'>{{ fb.protein }}</td>
                          <td>
                          </td>
                        </tr>
                        {% endfor %}
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div>
                  <!-- exercises -->
                  <div class="d-flex justify-content-between align-items-center"
                    style="background-color: #e9ecef;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 0.5rem;padding-bottom: 0.5rem;">
                    <h4>Exercises</h4>
                  </div>
                  <div style="padding: 0 1rem 1.5rem 1rem">
                    <table id='foodtable-ex' class='table table-hover'>
                      <thead>
                        <tr>
                          <th scope='col' class='col-md-2'>Exercise</th>
                          <th scope='col' class='col-md-2'>calories brûlées</th>
                          <th scope='col' class='col-md-2'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for ex in exercises %}
                        <tr>
                          <td class='col-md-2'>{{ ex.get_exercise_type_display }}</td>
                          <td class='col-md-2'>{{ ex.burned_calories }}</td>
                          <td class="d-flex justify-content-end">
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>

              </div>
            </div>

          </div>

          <div class='col-md-6 mt-4'>

            <div class='card bg-secondary mb-3'>
              <div class='card-header'>
                <h5>Objectif calorique quotidien - <strong class='text-primary'>
                    <span id="daily_calories">
                      {{ user.profile_triathlete.depense_energetique_journaliere|floatformat:"0" }}</span>
                    calories</strong></h5>
              </div>
              <div class='card-body justify-content-center'>
                <div class='progress' style="height: 40px;">
                  <div id='progressBar' class='progress-bar progress-bar-striped progress-bar-animated'
                    role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'
                    style='width: 0%; font-size: 25px;'>0%</div>
                </div>
                <div class="mt-3">
                  <h5 class="mb-3">Calories restantes</h5>
                  <div class="d-flex">
                    <div class="d-flex flex-column align-items-center">
                      <div>
                        <h6 id="goal_count">{{ goal_count|floatformat:"0" }}</h6>
                      </div>
                      <div>Objective</div>
                    </div>
                    <div class="d-flex flex-column align-items-center ms-3 me-3">
                      <h5>-</h5>
                    </div>
                    <div class="d-flex flex-column align-items-center">
                      <div>
                        <h6 id="aliments_count">{{ aliments_count|floatformat:"0" }}</h6>
                      </div>
                      <div>Aliments</div>
                    </div>
                    <div class="d-flex flex-column align-items-center ms-3 me-3">
                      <h5>+</h5>
                    </div>
                    <div class="d-flex flex-column align-items-center">
                      <div>
                        <h6 id="exercise_count">{{ exercise_count|floatformat:"0" }}</h6>
                      </div>
                      <div>Exercice</div>
                    </div>
                    <div class="d-flex flex-column align-items-center ms-3 me-3">
                      <h5>=</h5>
                    </div>
                    <div class="d-flex flex-column align-items-center">
                      <div>
                        <h6 id="remaining_count">{{ remaining_count|floatformat:"0" }}</h6>
                      </div>
                      <div>Restante</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class='card bg-secondary mb-3'>
              <input type="hidden" id="water_consumption_count" value="{{ water_consumption_count|floatformat:" 0" }}">
              <div class='card-header d-flex justify-content-between align-items-center'>
                <h5>Objectif eau quotidien - <strong class='text-primary'>
                    <span id="daily_water_goal">{{ daily_water_goal|floatformat:"0" }} </span>ml</strong></h5>
              </div>
              <div class='card-body justify-content-center'>
                <div class='progress' style="height: 40px;">
                  <div id='progressBar'
                    class='progress-bar progress-bar-water progress-bar-striped progress-bar-animated'
                    role='progressBar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'
                    style='width: 0%; font-size: 25px;'>0%</div>
                </div>
              </div>
            </div>

            <div class='card bg-secondary mb-3'>
              <div class='card-header'>
                <h5>Répartition des macronutriments</h5>
              </div>
              <div class='card-body justify-content-center'>
                <div class='chart-pie pt-4'>
                  <canvas id='myPieChart'></canvas>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

{% endblock body %}

{% block script %}
{{ block.super }}
<!-- Page level plugins -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- Page level custom scripts -->
<script src="{% static 'js/foodLog.js' %}"></script>
{% endblock %}