{% extends 'base.html' %}

{% load static %}

{% block title %}Food Tracker | Dashboard{% endblock %}

{% block body %}


<div class='py-4 mt-auto'>
  <div class='container-fluid px-4'>

    <h4>Bonjour, <strong>{{ user.first_name }}</strong>!</h4>

    <div class='row justify-content-center'>
      <div class='col-xl-12'>

        <div class='row'>
          <div class='col-md-6 mt-4'>

            <!-- <div class='card bg-secondary mb-3'>
              <div class='card-header'>
                <h5>Select food to add to the Food Log</h5>
              </div>
              <div class='card-body'>

                <div class='form-group'>
                  <form method='POST'>
                    {% csrf_token %}
                    <div class='form-group'>
                      <div class='row'>
                        <div class='col-8'>
                          <select class='form-select' name='food_consumed' id='food_consumed'>
                            {% for food in foods %}
                            <option value='{{food.food_name}}'>
                              {{ food.food_name }}
                            </option>
                            {% endfor %}
                          </select>
                        </div>
                        <div class='col-4'>
                          <button type='submit' class='btn btn-primary'>
                            Add Food
                          </button>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>

              </div>
            </div> -->

            <div class='card bg-secondary mb-3'>

              <div class='card-header'>
                <h5>Nourriture consommée aujourd'hui</h5>
                <h5><strong class='text-primary'>{% now 'D, j F Y' %}</strong></h5>
              </div>
              <div class='card-body' style="padding: 0;">

                <div>
                  <!-- breakfast -->
                  <div class="d-flex justify-content-between align-items-center"
                    style="background-color: #e9ecef;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 0.5rem;padding-bottom: 0.5rem;">
                    <h4>Breakfast</h4>
                    <a href="{% url 'add_daily_food' section='BREAKFAST' %}" class="btn btn-primary">
                      <i class='far fa-plus-square'></i>
                    </a>
                  </div>
                  <div style="padding: 0 1rem 1.5rem 1rem">
                    <table id='foodtable' class='table table-hover'>
                      <thead>
                        <tr>
                          <th scope='col' class='col-md-2'>Food Item</th>
                          <th scope='col' class='col-md-2'>Poids (g)</th>
                          <th scope='col' class='col-md-2'>Calories</th>
                          <th scope='col' class='col-md-2'>Fat</th>
                          <th scope='col' class='col-md-2'>Carbs</th>
                          <th scope='col' class='col-md-2'>Protein</th>
                          <th scope='col' class='col-md-2'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for fb in breakfast %}
                        <tr>
                          <td class='col-md-2'>
                            <a href="{% url 'aliment_detail' pk=fb.aliment.id %}">{{ fb.aliment.name }}</a>
                          </td>
                          <td class='col-md-2'>{{ fb.weight_g }}</td>
                          <td class='col-md-2'>{{ fb.total_energy_value }}</td>
                          <td class='col-md-2'>{{ fb.fat }}</td>
                          <td class='col-md-2'>{{ fb.carboheidrates }}</td>
                          <td class='col-md-2'>{{ fb.protein }}</td>
                          <td>
                            <a class='btn btn-danger' href="{% url 'delete_daily_food' pk=fb.id %}">
                              <i class='fas fa-trash-alt'></i>
                            </a>
                          </td>
                        </tr>
                        {% endfor %}
                        <tr>
                          <td id='foodName' class='col-md-2'><b>Total</b></td>
                          <td id='totalCalories' class='col-md-2'><b></b></td>
                          <td id='totalFat' class='col-md-2'><b></b></td>
                          <td id='totalCarbohydrates' class='col-md-2'><b></b></td>
                          <td id='totalProtein' class='col-md-2'><b></b></td>
                          <td></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

                <div>
                  <!-- lunch -->
                  <div class="d-flex justify-content-between align-items-center"
                    style="background-color: #e9ecef;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 0.5rem;padding-bottom: 0.5rem;">
                    <h4>Lunch</h4>
                    <a href="{% url 'add_daily_food' section='LUNCH' %}" class="btn btn-primary">
                      <i class='far fa-plus-square'></i>
                    </a>
                  </div>
                  <div style="padding: 0 1rem 1.5rem 1rem">
                    <table id='foodtable-lb' class='table table-hover'>
                      <thead>
                        <tr>
                          <th scope='col' class='col-md-2'>Food Item</th>
                          <th scope='col' class='col-md-2'>Poids (g)</th>
                          <th scope='col' class='col-md-2'>Calories</th>
                          <th scope='col' class='col-md-2'>Fat</th>
                          <th scope='col' class='col-md-2'>Carbs</th>
                          <th scope='col' class='col-md-2'>Protein</th>
                          <th scope='col' class='col-md-2'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for fb in lunch %}
                        <tr>
                          <td class='col-md-2'>
                            <a href="{% url 'aliment_detail' pk=fb.aliment.id %}">{{ fb.aliment.name }}</a>
                          </td>
                          <td class='col-md-2'>{{ fb.weight_g }}</td>
                          <td class='col-md-2'>{{ fb.total_energy_value }}</td>
                          <td class='col-md-2'>{{ fb.fat }}</td>
                          <td class='col-md-2'>{{ fb.carboheidrates }}</td>
                          <td class='col-md-2'>{{ fb.protein }}</td>
                          <td>
                            <a class='btn btn-danger' href="{% url 'delete_daily_food' pk=fb.id %}">
                              <i class='fas fa-trash-alt'></i>
                            </a>
                          </td>
                        </tr>
                        {% endfor %}
                        <!-- <tr>
                          <td id='foodName' class='col-md-2'><b>Total</b></td>
                          <td id='totalCalories' class='col-md-2'><b></b></td>
                          <td id='totalFat' class='col-md-2'><b></b></td>
                          <td id='totalCarbohydrates' class='col-md-2'><b></b></td>
                          <td id='totalProtein' class='col-md-2'><b></b></td>
                          <td></td>
                        </tr> -->
                      </tbody>
                    </table>
                  </div>
                </div>

                <div>
                  <!-- dinner -->
                  <div class="d-flex justify-content-between align-items-center"
                    style="background-color: #e9ecef;padding-left: 1.5rem;padding-right: 1.5rem;padding-top: 0.5rem;padding-bottom: 0.5rem;">
                    <h4>Dinner</h4>
                    <a href="{% url 'add_daily_food' section='DINNER' %}" class="btn btn-primary">
                      <i class='far fa-plus-square'></i>
                    </a>
                  </div>
                  <div style="padding: 0 1rem 1.5rem 1rem">
                    <table id='foodtable-db' class='table table-hover'>
                      <thead>
                        <tr>
                          <th scope='col' class='col-md-2'>Food Item</th>
                          <th scope='col' class='col-md-2'>Poids (g)</th>
                          <th scope='col' class='col-md-2'>Calories</th>
                          <th scope='col' class='col-md-2'>Fat</th>
                          <th scope='col' class='col-md-2'>Carbs</th>
                          <th scope='col' class='col-md-2'>Protein</th>
                          <th scope='col' class='col-md-2'></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for fb in dinner %}
                        <tr>
                          <td class='col-md-2'>
                            <a href="{% url 'aliment_detail' pk=fb.aliment.id %}">{{ fb.aliment.name }}</a>
                          </td>
                          <td class='col-md-2'>{{ fb.weight_g }}</td>
                          <td class='col-md-2'>{{ fb.total_energy_value }}</td>
                          <td class='col-md-2'>{{ fb.fat }}</td>
                          <td class='col-md-2'>{{ fb.carboheidrates }}</td>
                          <td class='col-md-2'>{{ fb.protein }}</td>
                          <td>
                            <a class='btn btn-danger' href="{% url 'delete_daily_food' pk=fb.id %}">
                              <i class='fas fa-trash-alt'></i>
                            </a>
                          </td>
                        </tr>
                        {% endfor %}
                        <!-- <tr>
                          <td id='foodName' class='col-md-2'><b>Total</b></td>
                          <td id='totalCalories' class='col-md-2'><b></b></td>
                          <td id='totalFat' class='col-md-2'><b></b></td>
                          <td id='totalCarbohydrates' class='col-md-2'><b></b></td>
                          <td id='totalProtein' class='col-md-2'><b></b></td>
                          <td></td> -->
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>

              </div>
            </div>

          </div>

          <div class='col-md-6 mt-4'>

            <div class='card bg-secondary mb-3'>
              <div class='card-header'>
                <h5>Objectif calorique quotidien - <strong class='text-primary'>
                    <span id="daily_calories">
                      {{ user.profile_triathlete.depense_energetique_journaliere|floatformat:"0" }}</span>
                    calories</strong></h5>
              </div>
              <div class='card-body justify-content-center'>

                <div class='progress' style="height: 40px;">
                  <div id='progressBar' class='progress-bar progress-bar-striped progress-bar-animated'
                    role='progressbar' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'
                    style='width: 0%; font-size: 25px;'>0%</div>
                </div>

              </div>
            </div>

            <div class='card bg-secondary mb-3'>
              <div class='card-header'>
                <h5>Répartition des macronutriments</h5>
              </div>
              <div class='card-body justify-content-center'>
                <div class='chart-pie pt-4'>
                  <canvas id='myPieChart'></canvas>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

  </div>
</div>

{% endblock body %}

{% block script %}
{{ block.super }}
<!-- Page level plugins -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<!-- Page level custom scripts -->
<script src="{% static 'js/foodLog.js' %}"></script>
{% endblock %}